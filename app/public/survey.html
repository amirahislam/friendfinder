<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="style.css" /> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    
    <!-- <script src="main.js"></script> -->
</head>
<body>

    <div class="container">
        <h1> Survey Questions</h1>
        <hr>
        <br>
        
        <form>
                <div class="form-group">
                  <label for="name">Name (Required)</label>
                  <input type="name" class="form-control" id="inputName" aria-describedby="nameHelp" placeholder="Enter Name">
                </div>
                <div class="form-group">
                    <label for="pasteImage">Link to image (Required)</label>
                    <input type="putImage" class="form-control" id="inputImage" aria-describedby="nameHelp" placeholder="Paste Image Link">
                </div>
                
                <h2>Question 1</h2><hr>
               <h3>How much do you love Harry Potter books?</h3>
               <select class="chosen-select" id="q1">
                   <option value></option>
                   <option value="1">1 (Not Really.)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Very much so!)</option>
               </select>
               <br>
               <br>

               <h2>Question 2</h2><hr>
               <h3>Do you like cilantro?</h3>
               <select class="chosen-select" id="q2">
                   <option value></option>
                   <option value="1">1 (Meh, not really.)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Yas! Cilantro is lyf!)</option>
               </select>
               <br>
               <br>

               <h2>Question 3</h2><hr>
               <h3>Sriracha?</h3>
               <select class="chosen-select" id="q3">
                   <option value></option>
                   <option value="1">1 (Too spicy!)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (On everything!)</option>
               </select>
               <br>
               <br>

               <h2>Question 4</h2><hr>
               <h3>Do you feel like you get sad if you don't get enough "likes" on your posts?</h3>
               <select class="chosen-select" id="q4">
                   <option value></option>
                   <option value="1">1 (Strongly Disagree)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Strongly Agree)</option>
               </select>
               <br>
               <br>

               <h2>Question 5</h2><hr>
               <h3>How do you feel about going out two days back-to-back?</h3>
               <select class="chosen-select" id="q5">
                   <option value></option>
                   <option value="1">1 (I'm not that social.)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Yeah! Let's do it!)</option>
               </select>
               <br>
               <br>

               <h2>Question 6</h2><hr>
               <h3>Do you get upset if people change plans last minute?</h3>
               <select class="chosen-select" id="q6">
                   <option value></option>
                   <option value="1">1 (Strongly Disagree)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Strongly Agree)</option>
               </select>
               <br>
               <br>

               <h2>Question 7</h2><hr>
               <h3>How do you feel about Pho?</h3>
               <select class="chosen-select" id="q7">
                   <option value></option>
                   <option value="1">1 (Umm, what is that?)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (OMG! Yas!)</option>
               </select>
               <br>
               <br>

               <h2>Question 8</h2><hr>
               <h3>Beyonce?</h3>
               <select class="chosen-select" id="q8">
                   <option value></option>
                   <option value="1">1 (Meh.)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Kween!)</option>
               </select>
               <br>
               <br>

               <h2>Question 9</h2><hr>
               <h3>How do you feel about being in the kitchen?</h3>
               <select class="chosen-select" id="q9">
                   <option value></option>
                   <option value="1">1 (No cooking for me!)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Love it! Channeling Ina!)</option>
               </select>
               <br>
               <br>

               <h2>Question 10</h2><hr>
               <h3>Forgine Movies?</h3>
               <select class="chosen-select" id="q10">
                   <option value></option>
                   <option value="1">1 (Hate reading subtitles!)</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5 (Oh yeah, love them!)</option>
               </select><br>
                <br>
                <br>
               
                <button type="submit" class="btn btn-warning" id="submit">Submit</button>
              </form>
        </div>
        
        <!-- Modal -->
        <div id="resultsModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
    
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h2 class="modalTitle">Yay! New Best Friend!</h2>
            </div>
            <div class="modal-body">
              <h3 id="matchName"></h3>
              <img id="matchPhoto" height=500px width=465px src="" alt="">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
    
        </div>
      </div>
</body>
</html>

<script type="text/javascript">

    var newFriend;
    
    $("#submit").on("click", function(event) {
      event.preventDefault();
      // Here we grab the form elements
        newFriend = {
           name: $("#inputName").val().trim(),
           photo: $("#inputImage").val().trim(),
           scores: [
               $("#q1").val().trim(),
               $("#q2").val().trim(),
               $("#q3").val().trim(),
               $("#q4").val().trim(),
               $("#q5").val().trim(),
               $("#q6").val().trim(),
               $("#q7").val().trim(),
               $("#q8").val().trim(),
               $("#q9").val().trim(),
               $("#q10").val().trim(),
           ]
       };
      console.log(newFriend);
      
      $.post("/api/friends", newFriend, function(data) {
            console.log("something");
         
         if (data) {
            alert("Yas! You are about to meet a new friend!");
          }
          
        //   else {
        //     alert("Hold on! You've already submitted a profile!");
        //   }
          // Clear the form when submitting
          name: $("#inputName").val("");
           photo: $("#inputImage").val("");
           scores: [
               $("#q1").val(""),
               $("#q2").val(""),
               $("#q3").val(""),
               $("#q4").val(""),
               $("#q5").val(""),
               $("#q6").val(""),
               $("#q7").val(""),
               $("#q8").val(""),
               $("#q9").val(""),
               $("#q10").val(""),
           ]
        });

        findFriends();
    });

    function findFriends () {
    var currentURL = window.location.origin;
    var scoresArray = [];
    var bestFriend;
    

        $.ajax({ url: currentURL + "/api/friends", method: "GET"})
            .then(function(friends) {
                console.log("URL: " + currentURL + "/api/friends");
                console.log(friends);
                console.log(friends.length);
        
        for (var i = 0; i < friends.length; i++) {
            console.log(friends[i].scores);
            if (newFriend.name !== friends[i].name) {
                scoresArray.push(friends[i].scores);
            };

            console.log(scoresArray);
            var diffArray =[];

            for (var j=0; j < scoresArray.length; j++) {
                
                var thisDiff = 0;
                console.log("Compare: ");
                console.log(newFriend);
                console.log("---------------------");
                console.log(scoresArray[j]);
                console.log(newFriend.scores);
                console.log("---------------------");

            for (var z = 0; z < 10; z++ ) {
                console.log(Math.abs(newFriend.scores[z] - scoresArray[j][z]));
                        var diff = Math.abs(newFriend.scores[z] - scoresArray[j][z]);
                        thisDiff = thisDiff + diff;
            };

                console.log("----------------------");
                console.log("Total Difference: " + thisDiff);
                diffArray.push(thisDiff);
                console.log(diffArray);

                console.log(Math.min(...diffArray));
                console.log(diffArray.indexOf(Math.min(...diffArray)));

                bestFriend = (diffArray.indexOf(Math.min(...diffArray)));
                console.log("Yay! We found you a friend! " + bestFriend);

            //     var bestMatch = app.get('/api/friends', function(req, res){
            //     res.json(bestFriend);
            
            // });
            var match = friends[bestFriend];
                console.log(match.name);
                $("#matchName").text(match.name);
                $("#matchPhoto").attr("src", match.photo);

                // Show the modal with the best match
                $("#resultsModal").modal("toggle");
        }
        };
        

        })

    }
  

</script>
